<script>
	pre (function () {
		ui = frame ('login');
		
		[] .forEach .call (ui .querySelectorAll ('#hint[for=input]'), function (_) {
			_ .outerHTML = input_ify (_);
		});
		
		def = serve (ui);
	})
</script>

<script>
	var _interaction = interaction_to_be (promise_of (function (is) {
		self .on ('mount', function () {
			var email_dom = self .root .querySelector ('#email');
			var password_dom = self .root .querySelector ('#password');
			
			var email_interaction =	interaction_placeholder (
										email_dom .querySelector ('#placeholder'),
										interaction_input (email_dom .querySelector ('input'))
									);
			var password_interaction =	interaction_placeholder (
											password_dom .querySelector ('#placeholder'), 
											interaction_input (password_dom .querySelector ('input'))
										);
	
			is (
				_interaction_ (self .root, {
					email: email_interaction,
					password: password_interaction
				})
			)
		})
	}))
	
	
	var _interaction_ =	function (dom, components) {
		var email = components .email;
		var password = components .password;
		
		var extension = interaction (transition (function (intent, license) {
			if (intent === 'login') {
				return from (function (tenure) {
					Promise .resolve ()
					.then (function () {
						if (! (email .state () ._ && email .state () .dom .checkValidity ())) {
							toast ('Please make sure you enter a valid email');}
						else {
							tenure ('logging-in');
							loader ();
							return inquire (api () .login, {
								email: email .state () ._,
								password: password .state () ._
							})
							.then (function (res) {
								loader .stop ();
								if (res .error) {
									toast ('There was a problem logging in');}
								else {
									window .location .href = routes .dashboard;}})
							.then (function () {
								tenure (null);})}})
					.then (function () {
						tenure .end (true) })
				})
			}
			else {
				console .error ('unknown intent passed', intent);
				return only_ ()
			}
		}));
		
		extension .state (null);
		click (dom .querySelector ('[action=focus]'), function () {
			extension .intent ('login');
		})
		click (dom .querySelector ('#make-account[action=side]'), function () {
			window .location .href = routes .make_account
		})
		
		return interaction_product ({
			_: extension,
			dom: {
				intent: stream (),
				state: stream (dom)
			},
			
			input_email: email,
			input_password: password
		})
	}
</script>